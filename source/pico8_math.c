#include "pico8_math.h"

#include <stdlib.h>
#include "pico8.h"

IWRAM_DATA const FIXED_16 SIN_F[512] = {
    0x0, 0x324, 0x648, 0x96c, 0xc8f, 0xfb2, 0x12d5, 0x15f6,
    0x1917, 0x1c37, 0x1f56, 0x2273, 0x2590, 0x28aa, 0x2bc4, 0x2edb,
    0x31f1, 0x3505, 0x3817, 0x3b26, 0x3e33, 0x413e, 0x4447, 0x474d,
    0x4a50, 0x4d50, 0x504d, 0x5347, 0x563e, 0x5931, 0x5c22, 0x5f0e,
    0x61f7, 0x64dc, 0x67bd, 0x6a9b, 0x6d74, 0x7049, 0x7319, 0x75e5,
    0x78ad, 0x7b70, 0x7e2e, 0x80e7, 0x839c, 0x864b, 0x88f5, 0x8b9a,
    0x8e39, 0x90d3, 0x9368, 0x95f6, 0x987f, 0x9b02, 0x9d7f, 0x9ff6,
    0xa267, 0xa4d2, 0xa736, 0xa994, 0xabeb, 0xae3b, 0xb085, 0xb2c8,
    0xb504, 0xb73a, 0xb968, 0xbb8f, 0xbdae, 0xbfc7, 0xc1d8, 0xc3e2,
    0xc5e4, 0xc7de, 0xc9d1, 0xcbbb, 0xcd9f, 0xcf7a, 0xd14d, 0xd318,
    0xd4db, 0xd695, 0xd848, 0xd9f2, 0xdb94, 0xdd2d, 0xdebe, 0xe046,
    0xe1c5, 0xe33c, 0xe4aa, 0xe60f, 0xe76b, 0xe8bf, 0xea09, 0xeb4b,
    0xec83, 0xedb2, 0xeed8, 0xeff5, 0xf109, 0xf213, 0xf314, 0xf40b,
    0xf4fa, 0xf5de, 0xf6ba, 0xf78b, 0xf853, 0xf912, 0xf9c7, 0xfa73,
    0xfb14, 0xfbac, 0xfc3b, 0xfcbf, 0xfd3a, 0xfdab, 0xfe13, 0xfe70,
    0xfec4, 0xff0e, 0xff4e, 0xff84, 0xffb1, 0xffd3, 0xffec, 0xfffb,
    0x10000, 0xfffb, 0xffec, 0xffd3, 0xffb1, 0xff84, 0xff4e, 0xff0e,
    0xfec4, 0xfe70, 0xfe13, 0xfdab, 0xfd3a, 0xfcbf, 0xfc3b, 0xfbac,
    0xfb14, 0xfa73, 0xf9c7, 0xf912, 0xf853, 0xf78b, 0xf6ba, 0xf5de,
    0xf4fa, 0xf40b, 0xf314, 0xf213, 0xf109, 0xeff5, 0xeed8, 0xedb2,
    0xec83, 0xeb4b, 0xea09, 0xe8bf, 0xe76b, 0xe60f, 0xe4aa, 0xe33c,
    0xe1c5, 0xe046, 0xdebe, 0xdd2d, 0xdb94, 0xd9f2, 0xd848, 0xd695,
    0xd4db, 0xd318, 0xd14d, 0xcf7a, 0xcd9f, 0xcbbb, 0xc9d1, 0xc7de,
    0xc5e4, 0xc3e2, 0xc1d8, 0xbfc7, 0xbdae, 0xbb8f, 0xb968, 0xb73a,
    0xb504, 0xb2c8, 0xb085, 0xae3b, 0xabeb, 0xa994, 0xa736, 0xa4d2,
    0xa267, 0x9ff6, 0x9d7f, 0x9b02, 0x987f, 0x95f6, 0x9368, 0x90d3,
    0x8e39, 0x8b9a, 0x88f5, 0x864b, 0x839c, 0x80e7, 0x7e2e, 0x7b70,
    0x78ad, 0x75e5, 0x7319, 0x7049, 0x6d74, 0x6a9b, 0x67bd, 0x64dc,
    0x61f7, 0x5f0e, 0x5c22, 0x5931, 0x563e, 0x5347, 0x504d, 0x4d50,
    0x4a50, 0x474d, 0x4447, 0x413e, 0x3e33, 0x3b26, 0x3817, 0x3505,
    0x31f1, 0x2edb, 0x2bc4, 0x28aa, 0x2590, 0x2273, 0x1f56, 0x1c37,
    0x1917, 0x15f6, 0x12d5, 0xfb2, 0xc8f, 0x96c, 0x648, 0x324,
    0x0, 0xfffffcdc, 0xfffff9b8, 0xfffff694, 0xfffff371, 0xfffff04e, 0xffffed2b, 0xffffea0a,
    0xffffe6e9, 0xffffe3c9, 0xffffe0aa, 0xffffdd8d, 0xffffda70, 0xffffd756, 0xffffd43c, 0xffffd125,
    0xffffce0f, 0xffffcafb, 0xffffc7e9, 0xffffc4da, 0xffffc1cd, 0xffffbec2, 0xffffbbb9, 0xffffb8b3,
    0xffffb5b0, 0xffffb2b0, 0xffffafb3, 0xffffacb9, 0xffffa9c2, 0xffffa6cf, 0xffffa3de, 0xffffa0f2,
    0xffff9e09, 0xffff9b24, 0xffff9843, 0xffff9565, 0xffff928c, 0xffff8fb7, 0xffff8ce7, 0xffff8a1b,
    0xffff8753, 0xffff8490, 0xffff81d2, 0xffff7f19, 0xffff7c64, 0xffff79b5, 0xffff770b, 0xffff7466,
    0xffff71c7, 0xffff6f2d, 0xffff6c98, 0xffff6a0a, 0xffff6781, 0xffff64fe, 0xffff6281, 0xffff600a,
    0xffff5d99, 0xffff5b2e, 0xffff58ca, 0xffff566c, 0xffff5415, 0xffff51c5, 0xffff4f7b, 0xffff4d38,
    0xffff4afc, 0xffff48c6, 0xffff4698, 0xffff4471, 0xffff4252, 0xffff4039, 0xffff3e28, 0xffff3c1e,
    0xffff3a1c, 0xffff3822, 0xffff362f, 0xffff3445, 0xffff3261, 0xffff3086, 0xffff2eb3, 0xffff2ce8,
    0xffff2b25, 0xffff296b, 0xffff27b8, 0xffff260e, 0xffff246c, 0xffff22d3, 0xffff2142, 0xffff1fba,
    0xffff1e3b, 0xffff1cc4, 0xffff1b56, 0xffff19f1, 0xffff1895, 0xffff1741, 0xffff15f7, 0xffff14b5,
    0xffff137d, 0xffff124e, 0xffff1128, 0xffff100b, 0xffff0ef7, 0xffff0ded, 0xffff0cec, 0xffff0bf5,
    0xffff0b06, 0xffff0a22, 0xffff0946, 0xffff0875, 0xffff07ad, 0xffff06ee, 0xffff0639, 0xffff058d,
    0xffff04ec, 0xffff0454, 0xffff03c5, 0xffff0341, 0xffff02c6, 0xffff0255, 0xffff01ed, 0xffff0190,
    0xffff013c, 0xffff00f2, 0xffff00b2, 0xffff007c, 0xffff004f, 0xffff002d, 0xffff0014, 0xffff0005,
    0xffff0000, 0xffff0005, 0xffff0014, 0xffff002d, 0xffff004f, 0xffff007c, 0xffff00b2, 0xffff00f2,
    0xffff013c, 0xffff0190, 0xffff01ed, 0xffff0255, 0xffff02c6, 0xffff0341, 0xffff03c5, 0xffff0454,
    0xffff04ec, 0xffff058d, 0xffff0639, 0xffff06ee, 0xffff07ad, 0xffff0875, 0xffff0946, 0xffff0a22,
    0xffff0b06, 0xffff0bf5, 0xffff0cec, 0xffff0ded, 0xffff0ef7, 0xffff100b, 0xffff1128, 0xffff124e,
    0xffff137d, 0xffff14b5, 0xffff15f7, 0xffff1741, 0xffff1895, 0xffff19f1, 0xffff1b56, 0xffff1cc4,
    0xffff1e3b, 0xffff1fba, 0xffff2142, 0xffff22d3, 0xffff246c, 0xffff260e, 0xffff27b8, 0xffff296b,
    0xffff2b25, 0xffff2ce8, 0xffff2eb3, 0xffff3086, 0xffff3261, 0xffff3445, 0xffff362f, 0xffff3822,
    0xffff3a1c, 0xffff3c1e, 0xffff3e28, 0xffff4039, 0xffff4252, 0xffff4471, 0xffff4698, 0xffff48c6,
    0xffff4afc, 0xffff4d38, 0xffff4f7b, 0xffff51c5, 0xffff5415, 0xffff566c, 0xffff58ca, 0xffff5b2e,
    0xffff5d99, 0xffff600a, 0xffff6281, 0xffff64fe, 0xffff6781, 0xffff6a0a, 0xffff6c98, 0xffff6f2d,
    0xffff71c7, 0xffff7466, 0xffff770b, 0xffff79b5, 0xffff7c64, 0xffff7f19, 0xffff81d2, 0xffff8490,
    0xffff8753, 0xffff8a1b, 0xffff8ce7, 0xffff8fb7, 0xffff928c, 0xffff9565, 0xffff9843, 0xffff9b24,
    0xffff9e09, 0xffffa0f2, 0xffffa3de, 0xffffa6cf, 0xffffa9c2, 0xffffacb9, 0xffffafb3, 0xffffb2b0,
    0xffffb5b0, 0xffffb8b3, 0xffffbbb9, 0xffffbec2, 0xffffc1cd, 0xffffc4da, 0xffffc7e9, 0xffffcafb,
    0xffffce0f, 0xffffd125, 0xffffd43c, 0xffffd756, 0xffffda70, 0xffffdd8d, 0xffffe0aa, 0xffffe3c9,
    0xffffe6e9, 0xffffea0a, 0xffffed2b, 0xfffff04e, 0xfffff371, 0xfffff694, 0xfffff9b8, 0xfffffcdc
};
IWRAM_DATA const FIXED_16 COS_F[512] = {
    0x10000, 0xfffb, 0xffec, 0xffd3, 0xffb1, 0xff84, 0xff4e, 0xff0e,
    0xfec4, 0xfe70, 0xfe13, 0xfdab, 0xfd3a, 0xfcbf, 0xfc3b, 0xfbac,
    0xfb14, 0xfa73, 0xf9c7, 0xf912, 0xf853, 0xf78b, 0xf6ba, 0xf5de,
    0xf4fa, 0xf40b, 0xf314, 0xf213, 0xf109, 0xeff5, 0xeed8, 0xedb2,
    0xec83, 0xeb4b, 0xea09, 0xe8bf, 0xe76b, 0xe60f, 0xe4aa, 0xe33c,
    0xe1c5, 0xe046, 0xdebe, 0xdd2d, 0xdb94, 0xd9f2, 0xd848, 0xd695,
    0xd4db, 0xd318, 0xd14d, 0xcf7a, 0xcd9f, 0xcbbb, 0xc9d1, 0xc7de,
    0xc5e4, 0xc3e2, 0xc1d8, 0xbfc7, 0xbdae, 0xbb8f, 0xb968, 0xb73a,
    0xb504, 0xb2c8, 0xb085, 0xae3b, 0xabeb, 0xa994, 0xa736, 0xa4d2,
    0xa267, 0x9ff6, 0x9d7f, 0x9b02, 0x987f, 0x95f6, 0x9368, 0x90d3,
    0x8e39, 0x8b9a, 0x88f5, 0x864b, 0x839c, 0x80e7, 0x7e2e, 0x7b70,
    0x78ad, 0x75e5, 0x7319, 0x7049, 0x6d74, 0x6a9b, 0x67bd, 0x64dc,
    0x61f7, 0x5f0e, 0x5c22, 0x5931, 0x563e, 0x5347, 0x504d, 0x4d50,
    0x4a50, 0x474d, 0x4447, 0x413e, 0x3e33, 0x3b26, 0x3817, 0x3505,
    0x31f1, 0x2edb, 0x2bc4, 0x28aa, 0x2590, 0x2273, 0x1f56, 0x1c37,
    0x1917, 0x15f6, 0x12d5, 0xfb2, 0xc8f, 0x96c, 0x648, 0x324,
    0x0, 0xfffffcdc, 0xfffff9b8, 0xfffff694, 0xfffff371, 0xfffff04e, 0xffffed2b, 0xffffea0a,
    0xffffe6e9, 0xffffe3c9, 0xffffe0aa, 0xffffdd8d, 0xffffda70, 0xffffd756, 0xffffd43c, 0xffffd125,
    0xffffce0f, 0xffffcafb, 0xffffc7e9, 0xffffc4da, 0xffffc1cd, 0xffffbec2, 0xffffbbb9, 0xffffb8b3,
    0xffffb5b0, 0xffffb2b0, 0xffffafb3, 0xffffacb9, 0xffffa9c2, 0xffffa6cf, 0xffffa3de, 0xffffa0f2,
    0xffff9e09, 0xffff9b24, 0xffff9843, 0xffff9565, 0xffff928c, 0xffff8fb7, 0xffff8ce7, 0xffff8a1b,
    0xffff8753, 0xffff8490, 0xffff81d2, 0xffff7f19, 0xffff7c64, 0xffff79b5, 0xffff770b, 0xffff7466,
    0xffff71c7, 0xffff6f2d, 0xffff6c98, 0xffff6a0a, 0xffff6781, 0xffff64fe, 0xffff6281, 0xffff600a,
    0xffff5d99, 0xffff5b2e, 0xffff58ca, 0xffff566c, 0xffff5415, 0xffff51c5, 0xffff4f7b, 0xffff4d38,
    0xffff4afc, 0xffff48c6, 0xffff4698, 0xffff4471, 0xffff4252, 0xffff4039, 0xffff3e28, 0xffff3c1e,
    0xffff3a1c, 0xffff3822, 0xffff362f, 0xffff3445, 0xffff3261, 0xffff3086, 0xffff2eb3, 0xffff2ce8,
    0xffff2b25, 0xffff296b, 0xffff27b8, 0xffff260e, 0xffff246c, 0xffff22d3, 0xffff2142, 0xffff1fba,
    0xffff1e3b, 0xffff1cc4, 0xffff1b56, 0xffff19f1, 0xffff1895, 0xffff1741, 0xffff15f7, 0xffff14b5,
    0xffff137d, 0xffff124e, 0xffff1128, 0xffff100b, 0xffff0ef7, 0xffff0ded, 0xffff0cec, 0xffff0bf5,
    0xffff0b06, 0xffff0a22, 0xffff0946, 0xffff0875, 0xffff07ad, 0xffff06ee, 0xffff0639, 0xffff058d,
    0xffff04ec, 0xffff0454, 0xffff03c5, 0xffff0341, 0xffff02c6, 0xffff0255, 0xffff01ed, 0xffff0190,
    0xffff013c, 0xffff00f2, 0xffff00b2, 0xffff007c, 0xffff004f, 0xffff002d, 0xffff0014, 0xffff0005,
    0xffff0000, 0xffff0005, 0xffff0014, 0xffff002d, 0xffff004f, 0xffff007c, 0xffff00b2, 0xffff00f2,
    0xffff013c, 0xffff0190, 0xffff01ed, 0xffff0255, 0xffff02c6, 0xffff0341, 0xffff03c5, 0xffff0454,
    0xffff04ec, 0xffff058d, 0xffff0639, 0xffff06ee, 0xffff07ad, 0xffff0875, 0xffff0946, 0xffff0a22,
    0xffff0b06, 0xffff0bf5, 0xffff0cec, 0xffff0ded, 0xffff0ef7, 0xffff100b, 0xffff1128, 0xffff124e,
    0xffff137d, 0xffff14b5, 0xffff15f7, 0xffff1741, 0xffff1895, 0xffff19f1, 0xffff1b56, 0xffff1cc4,
    0xffff1e3b, 0xffff1fba, 0xffff2142, 0xffff22d3, 0xffff246c, 0xffff260e, 0xffff27b8, 0xffff296b,
    0xffff2b25, 0xffff2ce8, 0xffff2eb3, 0xffff3086, 0xffff3261, 0xffff3445, 0xffff362f, 0xffff3822,
    0xffff3a1c, 0xffff3c1e, 0xffff3e28, 0xffff4039, 0xffff4252, 0xffff4471, 0xffff4698, 0xffff48c6,
    0xffff4afc, 0xffff4d38, 0xffff4f7b, 0xffff51c5, 0xffff5415, 0xffff566c, 0xffff58ca, 0xffff5b2e,
    0xffff5d99, 0xffff600a, 0xffff6281, 0xffff64fe, 0xffff6781, 0xffff6a0a, 0xffff6c98, 0xffff6f2d,
    0xffff71c7, 0xffff7466, 0xffff770b, 0xffff79b5, 0xffff7c64, 0xffff7f19, 0xffff81d2, 0xffff8490,
    0xffff8753, 0xffff8a1b, 0xffff8ce7, 0xffff8fb7, 0xffff928c, 0xffff9565, 0xffff9843, 0xffff9b24,
    0xffff9e09, 0xffffa0f2, 0xffffa3de, 0xffffa6cf, 0xffffa9c2, 0xffffacb9, 0xffffafb3, 0xffffb2b0,
    0xffffb5b0, 0xffffb8b3, 0xffffbbb9, 0xffffbec2, 0xffffc1cd, 0xffffc4da, 0xffffc7e9, 0xffffcafb,
    0xffffce0f, 0xffffd125, 0xffffd43c, 0xffffd756, 0xffffda70, 0xffffdd8d, 0xffffe0aa, 0xffffe3c9,
    0xffffe6e9, 0xffffea0a, 0xffffed2b, 0xfffff04e, 0xfffff371, 0xfffff694, 0xfffff9b8, 0xfffffcdc,
    0x0, 0x324, 0x648, 0x96c, 0xc8f, 0xfb2, 0x12d5, 0x15f6,
    0x1917, 0x1c37, 0x1f56, 0x2273, 0x2590, 0x28aa, 0x2bc4, 0x2edb,
    0x31f1, 0x3505, 0x3817, 0x3b26, 0x3e33, 0x413e, 0x4447, 0x474d,
    0x4a50, 0x4d50, 0x504d, 0x5347, 0x563e, 0x5931, 0x5c22, 0x5f0e,
    0x61f7, 0x64dc, 0x67bd, 0x6a9b, 0x6d74, 0x7049, 0x7319, 0x75e5,
    0x78ad, 0x7b70, 0x7e2e, 0x80e7, 0x839c, 0x864b, 0x88f5, 0x8b9a,
    0x8e39, 0x90d3, 0x9368, 0x95f6, 0x987f, 0x9b02, 0x9d7f, 0x9ff6,
    0xa267, 0xa4d2, 0xa736, 0xa994, 0xabeb, 0xae3b, 0xb085, 0xb2c8,
    0xb504, 0xb73a, 0xb968, 0xbb8f, 0xbdae, 0xbfc7, 0xc1d8, 0xc3e2,
    0xc5e4, 0xc7de, 0xc9d1, 0xcbbb, 0xcd9f, 0xcf7a, 0xd14d, 0xd318,
    0xd4db, 0xd695, 0xd848, 0xd9f2, 0xdb94, 0xdd2d, 0xdebe, 0xe046,
    0xe1c5, 0xe33c, 0xe4aa, 0xe60f, 0xe76b, 0xe8bf, 0xea09, 0xeb4b,
    0xec83, 0xedb2, 0xeed8, 0xeff5, 0xf109, 0xf213, 0xf314, 0xf40b,
    0xf4fa, 0xf5de, 0xf6ba, 0xf78b, 0xf853, 0xf912, 0xf9c7, 0xfa73,
    0xfb14, 0xfbac, 0xfc3b, 0xfcbf, 0xfd3a, 0xfdab, 0xfe13, 0xfe70,
    0xfec4, 0xff0e, 0xff4e, 0xff84, 0xffb1, 0xffd3, 0xffec, 0xfffb
};

// LUT for [-448, -1] mod 132
IWRAM_DATA const int MOD_132[448] = {
    80, 81, 82, 83, 84, 85, 86, 87,
    88, 89, 90, 91, 92, 93, 94, 95,
    96, 97, 98, 99, 100, 101, 102, 103,
    104, 105, 106, 107, 108, 109, 110, 111,
    112, 113, 114, 115, 116, 117, 118, 119,
    120, 121, 122, 123, 124, 125, 126, 127,
    128, 129, 130, 131, 0, 1, 2, 3,
    4, 5, 6, 7, 8, 9, 10, 11,
    12, 13, 14, 15, 16, 17, 18, 19,
    20, 21, 22, 23, 24, 25, 26, 27,
    28, 29, 30, 31, 32, 33, 34, 35,
    36, 37, 38, 39, 40, 41, 42, 43,
    44, 45, 46, 47, 48, 49, 50, 51,
    52, 53, 54, 55, 56, 57, 58, 59,
    60, 61, 62, 63, 64, 65, 66, 67,
    68, 69, 70, 71, 72, 73, 74, 75,
    76, 77, 78, 79, 80, 81, 82, 83,
    84, 85, 86, 87, 88, 89, 90, 91,
    92, 93, 94, 95, 96, 97, 98, 99,
    100, 101, 102, 103, 104, 105, 106, 107,
    108, 109, 110, 111, 112, 113, 114, 115,
    116, 117, 118, 119, 120, 121, 122, 123,
    124, 125, 126, 127, 128, 129, 130, 131,
    0, 1, 2, 3, 4, 5, 6, 7,
    8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23,
    24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39,
    40, 41, 42, 43, 44, 45, 46, 47,
    48, 49, 50, 51, 52, 53, 54, 55,
    56, 57, 58, 59, 60, 61, 62, 63,
    64, 65, 66, 67, 68, 69, 70, 71,
    72, 73, 74, 75, 76, 77, 78, 79,
    80, 81, 82, 83, 84, 85, 86, 87,
    88, 89, 90, 91, 92, 93, 94, 95,
    96, 97, 98, 99, 100, 101, 102, 103,
    104, 105, 106, 107, 108, 109, 110, 111,
    112, 113, 114, 115, 116, 117, 118, 119,
    120, 121, 122, 123, 124, 125, 126, 127,
    128, 129, 130, 131, 0, 1, 2, 3,
    4, 5, 6, 7, 8, 9, 10, 11,
    12, 13, 14, 15, 16, 17, 18, 19,
    20, 21, 22, 23, 24, 25, 26, 27,
    28, 29, 30, 31, 32, 33, 34, 35,
    36, 37, 38, 39, 40, 41, 42, 43,
    44, 45, 46, 47, 48, 49, 50, 51,
    52, 53, 54, 55, 56, 57, 58, 59,
    60, 61, 62, 63, 64, 65, 66, 67,
    68, 69, 70, 71, 72, 73, 74, 75,
    76, 77, 78, 79, 80, 81, 82, 83,
    84, 85, 86, 87, 88, 89, 90, 91,
    92, 93, 94, 95, 96, 97, 98, 99,
    100, 101, 102, 103, 104, 105, 106, 107,
    108, 109, 110, 111, 112, 113, 114, 115,
    116, 117, 118, 119, 120, 121, 122, 123,
    124, 125, 126, 127, 128, 129, 130, 131
};

// LUT for [0, 99] mod 10
const int MOD_10[100] = {
    0, 1, 2, 3, 4, 5, 6, 7,
    8, 9, 0, 1, 2, 3, 4, 5,
    6, 7, 8, 9, 0, 1, 2, 3,
    4, 5, 6, 7, 8, 9, 0, 1,
    2, 3, 4, 5, 6, 7, 8, 9,
    0, 1, 2, 3, 4, 5, 6, 7,
    8, 9, 0, 1, 2, 3, 4, 5,
    6, 7, 8, 9, 0, 1, 2, 3,
    4, 5, 6, 7, 8, 9, 0, 1,
    2, 3, 4, 5, 6, 7, 8, 9,
    0, 1, 2, 3, 4, 5, 6, 7,
    8, 9, 0, 1, 2, 3, 4, 5,
    6, 7, 8, 9
};

// period is between 0 and 1
FIXED_16 sin_fixed(FIXED_16 x){
    // [-inf,inf] to [0,inf]
    if(x < int2Fixed(0)) // map negative values to positive values mod 1
        x = ((1<<16) - (-x));
    // [0,inf] to [0,1]
    x = x & ((1<<16)-1); // mod 1 in fixed point
    // scale [0,1] to [0,512], then phase shift to [256, 768], then again clip to [0,512]
    int index = (fixed2Int(x *512) + 256) % 512; // +256 because pico sin() is inverted
    return SIN_F[index];
}

// x >= 0, period is between 0 and 1
FIXED_16 cos_fixed(FIXED_16 x){
    // [-inf,inf] to [0,inf]
    if(x < int2Fixed(0)) // map negative values to positive values mod 1
        x = (int2Fixed(1) - (-x));
    // [0,inf] to [0,1]
    x = x & (int2Fixed(1)-1); // mod 1 in fixed point
    // scale [0,1] to [0,512], then phase shift to [128, 640], then again clip to [0,512]
    int index = (fixed2Int(x *512) + 128) % 512; // +128 because cos() is just shifted sin()
    return SIN_F[index];
}

// only works if x is between [-448, 131]
int mod_132(int x){
    if(x >= 0) 
        return x;
    #ifdef DEBUG
        if(x < -448)
            errorHalt("mod132 oob");
    #endif
    return MOD_132[x+448];
}

// only works if x is between [0, 99]
int mod_10(int x){
    #ifdef DEBUG
        if(x < 0 || x > 99)
            errorHalt("mod10 oob");
    #endif
    return MOD_10[x];
}

int rnd(int max){
    int num = rand()%max;
	return num<0 ? num+max : num;
}